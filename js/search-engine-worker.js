importScripts("fuse.min.js"),importScripts("Rx.min.js"),importScripts("SearchEngine.js");var BUFFER_COUNT=400,BUFFER_INTERVAL=1e3,resultSubscription=new Rx.BehaviorSubject(null),resultStreamSource=new Rx.Subject,newInterval=Rx.Observable.from(Rx.Observable.interval(100)),resultStream=resultStreamSource["switch"]().zip(Rx.Observable.interval(BUFFER_INTERVAL),function(e,s){return e}).map(function(e){return e.filter(function(e){return e.hasOwnProperty("uid")})}),sendMessage=function(e,s){messageSubj.next({type:e,value:s})},sendResults=function(e){if(sendMessage(MessageType.resultCount,e.length),null!==resultSubscription.value&&resultSubscription.value.unsubscribe(),0!==e.length){var s=BUFFER_COUNT-e.length%BUFFER_COUNT,r=Array(s).fill({}),n=e.concat(r),t=resultStream.subscribe(function(e){return sendMessage(MessageType.resultAdd,e)});resultSubscription.next(t);var a=Rx.Observable.from(n).bufferCount(BUFFER_COUNT);resultStreamSource.next(a)}},messageSubj=Rx.Subject.create().debounceTime(35).subscribe(function(e){return self.postMessage(e)}),se;self.onerror=function(e){return console.error(e)};var messageEventHandler=function(e){var s=e.data;if(s.type===MessageType.data||void 0!=se){var r=function(e){switch(e){case"data":se=new SearchEngine(s.value),r("eventrange");break;case"info":var n=s.value,t=se.getInfoById(n);void 0!==t&&sendMessage(MessageType.info,t);break;case"query":try{var a=s.value,u=se.getResultsByTerm(a);sendResults(u)}catch(i){console.error("fromWorker",i)}break;case"queryTime":var o=s.value,l=se.eventResultsAtTime(o);sendResults(l);break;case"eventrange":sendMessage(MessageType.eventrange,se.eventRange);break;default:console.error("Unknown message type "+s.type+" received by search-engine-worker.js",s)}};r(s.type)}};self.onmessage=function(e){return messageEventHandler(e)};