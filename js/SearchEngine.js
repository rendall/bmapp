var BMInfoType;!function(t){t[t.art=0]="art",t[t.camp=1]="camp",t[t.event=2]="event"}(BMInfoType||(BMInfoType={}));var MessageType;!function(t){t.info="info",t.eventrange="eventrange",t.resultCount="resultCount",t.resultAdd="resultAdd",t.data="data"}(MessageType||(MessageType={}));var uniq=function(t,e,n){if(void 0===e&&(e=[]),void 0===n&&(n=0),n>=t.length)return e;var r=-1===e.indexOf(t[n])?e.concat([t[n]]):e;return uniq(t,r,n+1)},getRange=function(t){for(var e=Number.MAX_VALUE,n=Number.MIN_VALUE,r=0;r<t.length;r++){var a=t[r];a>n&&(n=a),e>a&&(e=a)}return[e,n]},assoc=function(t,e,n){var r=function(t,e,n,a){void 0===e&&(e=[]),void 0===n&&(n=[]),void 0===a&&(a=!0);var i=function(t){return"object"==typeof t?null===t?null:t.hasOwnProperty("length")?"Array":void 0!==t.toDateString?"Date":"Object":t},o=function(i){for(var o=e.length,u=0;o>u;){if(t===e[u])return n[u];u+=1}e[u+1]=t,n[u+1]=i;for(var c in t)i[c]=a?r(t[c],e,n,!0):t[c];return i};switch(i(t)){case"Object":return o({});case"Array":return o([]);case"Date":return new Date(t.valueOf());default:return t}},a=r(n);return a[t]=e,a},isEmpty=function(t){return void 0===t||null===t||""===t||t.hasOwnProperty("length")&&0===t.length},isArt=function(t){return t.hasOwnProperty("artist")},isEvent=function(t){return t.hasOwnProperty("event_id")},isCamp=function(t){return t.hasOwnProperty("contact_email")&&!t.hasOwnProperty("artist")},getType=function(t){return isArt(t)?"art":isEvent(t)?"event":isCamp(t)?"camp":""},resultFromInfo=function(t){return{uid:t.uid,name:t.name||t.title,type:isArt(t)?BMInfoType.art:isEvent(t)?BMInfoType.event:BMInfoType.camp,event_type:isEvent(t)?t.event_type:void 0,location:isEmpty(t.location)?void 0:t.location}},resultFromFuseResult=function(t){var e=resultFromInfo(t.item),n=assoc("matches",t.matches,e),r=assoc("score",t.score,n);return r},SearchEngine=function(){function t(t,e){void 0===e&&(e=Fuse);var n={shouldSort:!0,findAllMatches:!0,includeScore:!0,includeMatches:!0,threshold:.15,location:0,distance:1999,maxPatternLength:32,minMatchCharLength:10,keys:[{name:"name",weight:.5},{name:"title",weight:.5},{name:"description",weight:.375},{name:"artist",weight:.5},{name:"event_type.label",weight:1},{name:"hometown",weight:.25},{name:"location.string",weight:1},{name:"type",weight:1}]},r=t.arts.concat(t.camps).concat(t.events).map(function(t){return assoc("type",getType(t),t)}),a=r.map(function(t){return null===t.description?assoc("description","",t):t}),i=a.map(function(t){return t.uid}),o=t.events.filter(function(t){return void 0!==t.occurrence_set}).map(function(t){return t.occurrence_set}).reduceRight(function(t,e){return t.concat(e)}).map(function(t){return new Date(t.start_time).valueOf()}),u=function(t){return i.indexOf(t)},c=function(e){return t.events.filter(function(t){return void 0!==t.occurrence_set&&t.occurrence_set.some(function(t){return new Date(t.start_time).valueOf()<=e&&new Date(t.end_time).valueOf()>e})})},s=function(e){return t.events.filter(function(t){return t.located_at_art===e.uid})},f=function(e){return t.events.filter(function(t){return t.hosted_by_camp===e.uid})},l=function(t){return isEmpty(t.hosted_by_camp)?isEmpty(t.located_at_art)?void 0:h(t.located_at_art,!1).location:h(t.hosted_by_camp,!1).location},v=function(t){return isEmpty(t)||isEmpty(t.location)?assoc("location",l(t),t):t},m=new Fuse(a,n),p=function(t){return m.search(t)},d=function(t){return r.find(function(e){return e.uid===i[t]})},h=function(t,e){void 0===e&&(e=!0);var n=u(t),r=d(n);if(void 0===r)return r;var a=r;if(e&&isArt(a)){var i=s(a);return assoc("events",i,a)}if(e&&isCamp(a)){var o=f(a);return assoc("events",o,a)}if(isEvent(a)){var c=a;if(!isEmpty(c.hosted_by_camp)){var l=h(c.hosted_by_camp,!1),v=assoc("location",l.location,a);return assoc("camp",l,v)}if(!isEmpty(c.located_at_art)){var m=h(c.located_at_art,!1),p=assoc("location",m.location,a);return assoc("art",m,p)}}return a};this.getInfoById=h,this.eventRange=getRange(o),this.getResultsByTerm=function(t){return p(t).map(function(t){return isEvent(t)?v(t):t}).map(resultFromFuseResult)},this.eventResultsAtTime=function(t){return c(t).map(v).map(resultFromInfo)}}return t}();